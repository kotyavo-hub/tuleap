.PHONY: first-start
first-start: dev-setup wipe-containers prepare-backend prepare-fronted start post-checkout

.PHONY: wipe-containers
wipe-containers:
	docker-compose rm --stop --force -v
	docker-compose down --volumes --remove-orphans

.PHONY: prepare-backend
prepare-backend:
	make composer

.PHONY: prepare-fronted
prepare-frontend:
	docker-compose -f docker-compose-dev.yml run --rm node npm install
	docker-compose -f docker-compose-dev.yml run --rm node npm run build

.PHONY: dev-setup
dev-setup:
	make dev-setup

.PHONY: start
start:
	make start

.PHONY: post-checkout
post-checkout:
	make post-checkout

.PHONY: follow-error-logs
follow-error-logs:
	docker-compose exec web bash -c "tail -F /var/log/tuleap/codendi_syslog -F /var/log/httpd/error_log -F /var/log/nginx/error.log"

.PHONY: exec
exec:
	docker-compose exec web tuleap $(cmd)

.PHONY: restart
restart:
	docker-compose stop
	make start

.PHONY: xdebug-off
xdebug-off:
	docker-compose exec web mv /etc/opt/remi/php73/php.d/15-xdebug.ini /etc/opt/remi/php73/php.d/15-xdebug.ini.disabled
	make -f MakefileDev restart

.PHONY: xdebug-on
xdebug-on:
	docker-compose exec web mv /etc/opt/remi/php73/php.d/15-xdebug.ini.disabled /etc/opt/remi/php73/php.d/15-xdebug.ini
	make -f MakefileDev restart
